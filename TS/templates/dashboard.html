{% extends "ts_index.html" %}

{% block content %}
<div id="view-violations-content" class="content-section" style="display: none;">
  
  <div class="section-header">
    <div class="title-section">
      <i class="fas fa-table" aria-hidden="true"></i> RECENT VIOLATIONS
    </div>

    <div class="controls">
      <div class="filter-container">
        <select id="filter-by-status" class="status sort-btn">
          <option value="" disabled selected>ID Status</option>
          <option value="claimed">Claimed</option>
          <option value="unclaimed">Unclaimed</option>
        </select>
      </div>

      <div class="sort-container">
        <select id="sort-by" class="status sort-btn">
          <option value="" disabled selected>Sort By</option>
          <option value="date">Date</option>
          <option value="student-name">Student Name</option>
        </select>
      </div>

      <div class="search-container">
        <input type="text" id="search-student" class="status sort-btn" placeholder="Search Student" />
      </div>
    </div>
  </div>

  <div class="container">
    <table class="violations-table">
      <thead>
        <tr>
          <th>Student Name</th>
          <th>Student ID</th>
          <th>Ticket #</th>
          <th>Violation Type</th>
          <th>Date/Time</th>
          <th>OSA Status</th>
          <th>ID Status</th>
          <th>Actions</th>
        </tr>
      </thead>

      <tbody id="violations-table-body">
        {% for v in violations %}
        <tr>
          <td>{{ v.student_name }}</td>
          <td>{{ v.student_id }}</td>
          <td>{{ v.ticket_number }}</td>
          <td>{{ v.violation_type }}</td>
          <td>{{ v.date_time }}</td>
          <td>
            {% if v.status == "Pending" %}
              <span style="color: red;">Pending</span>
            {% elif v.status == "Resolved" %}
              <span style="color: orange;">Resolved</span>
            {% elif v.status == "ID Claimed" %}
              <span style="color: green;">ID Claimed</span>
            {% else %}
              {{ v.status }}
            {% endif %}
          </td>
          <td>
            {% if v.status == "ID Claimed" %}
              <span>Claimed</span>
            {% else %}
              <span>Unclaimed</span>
            {% endif %}
          </td>
          <td>
            <button>Edit</button>
            <button>Delete</button>
          </td>
        </tr>
        {% empty %}
        <tr>
          <td colspan="8">No violations found.</td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>

</div>

<!-- Correct place for scripts: AFTER content -->
<script>
  document.addEventListener('DOMContentLoaded', function () {
    const viewViolationsBtn = document.getElementById('view-violations-button');  
    const viewViolationsContent = document.getElementById('view-violations-content');  

    if (viewViolationsBtn && viewViolationsContent) {
      viewViolationsBtn.addEventListener('click', function () {
        // Hide all sections first
        document.querySelectorAll('.content-section').forEach(section => {
          section.style.display = 'none';
        });

        // Then show the violations section
        viewViolationsContent.style.display = 'block';
      });
    }
  });
</script>
{% endblock %}
